<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>New document</title>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<script type="text/javascript" src="scripts/jQueryRotate.2.2.js"></script>
	<script type="text/javascript" src="scripts/jquery.path.js"></script>
	<link rel="stylesheet" type="text/css" href="css/mlpstyle.css" />
</head>

<script type="text/javascript">

	$(document).ready(function () {
		
		//every second
		setInterval(secTick, 1000);

		//every minute
		setInterval(toggleSky, 1000);

		//every hour
		setInterval(moveSunAndMoon, 500);

		$("#skyDay img").fadeIn(250);

	});
	var curHour = 0;
	var curMin = 0;
	var curSec = 0;
	var isDay = 1;

	var secAngle = 1;
	var secTick = function () {

		$("#blades").rotate({
			animateTo: secAngle,
			duration: 500,
		});

		secAngle += 20;
		//Todo: fix this secAngle %= 361;
	}

	curSkyDayFade = 1.0;
	var toggleSky = function () {

		if (isDay) {
			//$("#skyDay").fadeTo("slow", 0.1);
			curSkyDayFade -= 0.1;
		}

		secAngle += 20;
	}
	
	//using 13 hrs for animation [0-12]
	var noOfHours = 12;
	var moveAngle = 5;
	var moveSpeed = 200;
	var sunForwardX = [35, 79, 144, 223, 314, 424, 541, 654, 762, 857, 931, 1000, 1050];
	var sunForwardY = [510, 419, 312, 222, 154, 107, 91, 107, 154, 222, 312, 419, 510];
	var moveSunAndMoon = function () {
		//check if hour overflows if so flip day and night
		if (curHour == noOfHours-1)
			isDay = !isDay;

		//increment hour and mod by no of hours to get next index to coordinates for sun
		curHour++;
		curHour %= noOfHours;

		var bezier_params_forward = {
			start: { x: sunForwardX[curHour], y: sunForwardY[curHour], angle: -moveAngle, length: 0.5 },
			end: { x: sunForwardX[curHour + 1], y: sunForwardY[curHour + 1], angle: moveAngle, length: 0.5 }
		}

		if (isDay)
			$("#sun").animate({path: new $.path.bezier(bezier_params_forward)}, moveSpeed);
		else
			$("#moon").animate({path: new $.path.bezier(bezier_params_forward)}, moveSpeed);
	}

</script>
<body>
	<div id="canvas">
		<div class="frame" id="skyDay">
			<img src="imgs/skyDay.png" />
		</div>
		<div class="frame" id="skyNight">
			<img src="imgs/skyDay.png" />
		</div>
		<div class="frame" id="bg">
			<img src="imgs/bg.png" />
		</div>
		<div class="frame" id="blades">
			<img src="imgs/blades.png" />
		</div>
		<div class="frame" id="sun">
			<img src="imgs/sun.png" />
		</div>
		<div class="frame" id="moon">
			<img src="imgs/moon.png" />
		</div>
	</div>
</body>
</html>